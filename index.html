<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="メールでのご予約が簡単にできます。本予約、仮予約、予約変更、キャンセル、空き状況確認のメールテンプレートをご利用ください。">
    <meta name="keywords" content="予約,メール,本予約,仮予約,予約変更,キャンセル,空き状況,テンプレート">
    <meta name="author" content="予約システム">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#4a90e2">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="メールでの予約">
    <meta property="og:description" content="メールでのご予約が簡単にできます。本予約、仮予約、予約変更、キャンセル、空き状況確認のメールテンプレートをご利用ください。">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="メールでの予約">
    <meta name="twitter:description" content="メールでのご予約が簡単にできます。本予約、仮予約、予約変更、キャンセル、空き状況確認のメールテンプレートをご利用ください。">

    <!-- Mobile optimizations -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="メール予約">

    <!-- Security -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <title>メールでの予約 - 簡単予約システム</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <a href="#main-content" class="skip-link">メインコンテンツにスキップ</a>
    <main id="main-content">
      <header>
        <h1>📩 メールでのご予約について</h1>
        <p>フォームがご利用いただけない方は、以下のボタンからメールでご予約ください。</p>
      </header>

      <section aria-labelledby="actions-heading">
        <h2 id="actions-heading" class="visually-hidden">予約アクション</h2>
        <div class="button-container">
          <a
            href=""
            class="button blue"
            aria-label="本予約の申し込み - メールソフトを開きます"
          >📧 本予約の申し込み</a>
          <a
            href=""
            class="button blue"
            aria-label="仮予約の申し込み - メールソフトを開きます"
          >📧 仮予約の申し込み</a>
          <a
            href=""
            class="button yellow"
            aria-label="仮予約から本予約への変更 - メールソフトを開きます"
          >🔄 仮予約から本予約への変更</a>
          <a
            href=""
            class="button red"
            aria-label="予約の変更 - メールソフトを開きます"
          >✏️ 予約の変更</a>
          <a
            href=""
            class="button red"
            aria-label="予約のキャンセル - メールソフトを開きます"
          >❌ 予約のキャンセル</a>
          <a
            href=""
            class="button green"
            aria-label="空き状況を問い合わせる - メールソフトを開きます"
          >❓ 空き状況を問い合わせる</a>
        </div>
        <div class="notice" role="note" aria-label="重要な情報">
          <details class="help-details">
            <summary><strong>キャンセルポリシー</strong></summary>
            <div class="help-content">
              <p>以下のキャンセルポリシーにご同意いただいた上で、お進みください。</p>
              <ul>
                <li>本予約完了後の取り消しは、キャンセル料100%頂きます。</li>
                <li>本予約完了後から50％以上の減員は、キャンセル料100％を頂きます。</li>
              </ul>
            </div>
          </details>
          
          <details class="help-details">
            <summary><strong>注意事項</strong></summary>
            <div class="help-content">
              <p>以下の注意事項をご理解いただいた上で、お進みください。</p>
              <ul>
                <li>予約確定の返信メールが届いた時点で予約完了となります。<br>
                （ご希望された日時に予約をお受けできないこともございます。）</li>
                <li>クラス・班ごとの席割りは受け付けておりません。流し込みでお願いします。<br>
                （イメージ図はホームページに掲載しております。）</li>
                <li>到着時間が遅れる場合は1時間前に必ずご連絡ください。<br>
                (前後の予約有無により、ご希望の時間変更に対応できない場合がございます。)</li>
                <li>アレルギー情報　（<a href="https://www.xn--t8jg3mz29n7vdbuczw6c.com/reservation/" target="_blank" rel="noopener">https://www.xn--t8jg3mz29n7vdbuczw6c.com/reservation/</a>）<br>
                （一枚の鉄板で調理しますので100％除去はできかねます。一部除去はできます。）<br>
                （最終的にはお客様ご自身が専門医に相談するなどご判断下さいますようお願い致します。）</li>
              </ul>
            </div>
          </details>
          
          <details class="help-details">
            <summary><strong>仮予約の注意事項</strong></summary>
            <div class="help-content">
              <p>以下をご理解いただいた上で、お進みください。</p>
              <ul>
                <li>仮予約期間は、食事日の1ヶ月前までとなります。</li>
                <li>同じ日時に他のお客様の本予約が入った場合、本予約を優先し、仮予約を取り消しさせていただきます。<br>
                ※日程が確定しましたら、お早めに本予約をお願いします。</li>
                <li>仮予約の場合、キャンセル料は発生しません。</li>
              </ul>
            </div>
          </details>
        </div>
        <div class="notice" role="note" aria-label="重要な注意事項">
          <strong>ボタンを押してもメーラーが開かない場合</strong>は、下記のテンプレート文を利用して、ご自身のメールソフトやWebメールから直接お送りください。
        </div>
      </section>

      <section aria-labelledby="email-heading">
        <h2 id="email-heading" class="visually-hidden">メールアドレス情報</h2>
        <div class="email-line">
          <span class="email-label">宛先：</span>
          <code id="emailAddress" aria-label="メールアドレス"></code>
          <button type="button" class="copy-btn" onclick="copyText('emailAddress')" aria-label="メールアドレスをクリップボードにコピー">
            📋 コピーする
          </button>
        </div>
      </section>

      <section aria-labelledby="templates-heading">
        <h2 id="templates-heading" class="visually-hidden">メールテンプレート</h2>
        <ul id="templates-container"></ul>
      </section>
    </main>

    <script>
      const EMAIL_ADDRESS = 'kyouwakoku258@gmail.com';
      
      const templates = [
        {
          title: '🟦 [本予約の申し込み]のメールテンプレート',
          subject: '本予約の申し込み',
          body: `以下の内容で本予約を申し込みます。

旅行会社名：
住所：
電話：
担当者名：
当日責任者 携帯番号：
団体名ふりがな：
団体名：
食事日：
食事開始時間：
※食事時間は45分でお願いします。宴会などの場合は備考にてご希望をお知らせください。
人数：
T/C：
D/G：
支払い条件：
料理名：
備考：

●本メールの送信をもって、キャンセルポリシーおよび注意事項にご同意いただいたものとさせていただきます。`
        },
        {
          title: '🟦 [仮予約の申し込み]のメールテンプレート',
          subject: '仮予約の申し込み',
          body: `以下の内容で仮予約を申し込みます。

旅行会社名：
住所：
電話：
担当者名：
当日責任者 携帯番号：
団体名ふりがな：
団体名：
食事日：
食事開始時間：
※食事時間は45分でお願いします。宴会などの場合は備考にてご希望の時間をお知らせください。
人数：
T/C：
D/G：
支払い条件：
料理名：
備考：`
        },
        {
          title: '🟨 [本予約へ変更]のメールテンプレート',
          subject: '本予約へ変更希望',
          body: `以下の仮予約の本予約への変更を申し込みます。

旅行会社名：
担当者名：
仮予約時の受付No：
※受付Noが不明な場合は以下をご記入ください。
予約した食事日：
予約した食事開始時間：

●本メールの送信をもって、キャンセルポリシーおよび注意事項にご同意いただいたものとさせていただきます。`
        },
        {
          title: '🟥 [予約の変更]のメールテンプレート',
          subject: '予約変更の申し込み',
          body: `以下の予約内容の変更を申し込みます。

旅行会社名：
担当者名：
予約時の受付No：
※受付Noが不明な場合は以下をご記入ください。
予約した食事日：
予約した食事開始時間：

＜希望する変更内容＞
食事日：
食事開始時間：
人数：
T/C：
D/G：
料理名：
その他：`
        },
        {
          title: '🟥 [予約のキャンセル]のメールテンプレート',
          subject: '予約キャンセルの申し込み',
          body: `以下の予約をキャンセルします。

旅行会社名：
担当者名：

予約時の受付No：
※受付Noが不明な場合は以下をご記入ください。
予約した食事日：
予約した食事開始時間：`
        },
        {
          title: '🟩 [空き状況の問い合わせ]のメールテンプレート',
          subject: '空き状況の問い合わせ',
          body: `以下の日時で空き状況を教えてください。

旅行会社名：
担当者名：
食事日：
食事開始時間：
人数：
その他のご質問：`
        }
      ];

      function createTemplateBox(template, index) {
        // Escape HTML to prevent XSS
        const escapeHtml = (str) => {
          const div = document.createElement('div');
          div.textContent = str;
          return div.innerHTML;
        };
        
        const safeTitle = escapeHtml(template.title);
        const safeSubject = escapeHtml(template.subject);
        const safeBody = escapeHtml(template.body);
        const safeAriaLabel = escapeHtml(template.subject);
        
        return `
          <li class="template-box">
            <h3>${safeTitle}</h3>
            <div class="heading-line">
              <h4>件名</h4>
              <button type="button" class="copy-btn" onclick="copyText('subject${index}')" aria-label="件名をクリップボードにコピー: ${safeAriaLabel}">
                📋 コピーする
              </button>
            </div>
            <pre id="subject${index}" aria-label="メール件名">${safeSubject}</pre>
            <div class="heading-line">
              <h4>本文</h4>
              <button type="button" class="copy-btn" onclick="copyText('template${index}')" aria-label="本文をクリップボードにコピー">
                📋 コピーする
              </button>
            </div>
            <pre id="template${index}" aria-label="メール本文テンプレート">${safeBody}</pre>
          </li>
        `;
      }

      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('emailAddress').textContent = EMAIL_ADDRESS;
        
        const templatesContainer = document.getElementById('templates-container');
        templates.forEach((template, index) => {
          templatesContainer.innerHTML += createTemplateBox(template, index + 1);
        });
        
        const buttons = document.querySelectorAll('.button-container .button');
        buttons.forEach((button, index) => {
          const template = templates[index];
          if (template) {
            const subject = encodeURIComponent('【' + template.subject + '】');
            const body = encodeURIComponent(template.body);
            
            // 本予約の申し込みボタンまたは仮予約から本予約への変更ボタンの場合は確認ダイアログを表示
            if (index === 0 || index === 2) {
              button.addEventListener('click', function(e) {
                e.preventDefault();
                const confirmed = confirm(
                  '【キャンセルポリシーの確認】\n\n' +
                  '以下のキャンセルポリシーにご同意いただけますか？\n\n' +
                  '・本予約完了後の取り消しは、キャンセル料100%頂きます。\n' +
                  '・本予約完了後から50％以上の減員は、キャンセル料100％を頂きます。\n\n' +
                  '同意される場合は「OK」を押してください。'
                );
                
                if (confirmed) {
                  window.location.href = `mailto:${EMAIL_ADDRESS}?subject=${subject}&body=${body}`;
                }
              });
            } else if (index === 1) {
              // 仮予約の申し込みボタンの場合は仮予約の注意事項を表示
              button.addEventListener('click', function(e) {
                e.preventDefault();
                const confirmed = confirm(
                  '【仮予約の注意事項の確認】\n\n' +
                  '以下の注意事項をご理解いただけますか？\n' +
                  '・仮予約期間は、食事日の1ヶ月前までとなります。\n' +
                  '・同じ日時に他のお客様の本予約が入った場合、本予約を優先し、仮予約を取り消しさせていただきます。\n' +
                  '・キャンセル料は発生しません。\n\n' +
                  '同意される場合は「OK」を押してください。'
                );
                
                if (confirmed) {
                  window.location.href = `mailto:${EMAIL_ADDRESS}?subject=${subject}&body=${body}`;
                }
              });
            } else {
              button.href = `mailto:${EMAIL_ADDRESS}?subject=${subject}&body=${body}`;
            }
          }
        });
      });

      function showMessage(message, type = 'success') {
        // Remove existing messages
        const existingMessage = document.querySelector('.copy-message');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        // Create message element
        const messageEl = document.createElement('div');
        messageEl.className = `copy-message copy-message-${type}`;
        messageEl.textContent = message;
        messageEl.setAttribute('role', 'status');
        messageEl.setAttribute('aria-live', 'polite');
        
        // Add to body
        document.body.appendChild(messageEl);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
          if (messageEl.parentNode) {
            messageEl.remove();
          }
        }, 3000);
      }
      
      function copyText(id) {
        const el = document.getElementById(id);
        if (!el) {
          showMessage('コピー対象が見つかりませんでした', 'error');
          return;
        }
        
        const text = el.textContent || el.innerText;
        if (!text.trim()) {
          showMessage('コピーする内容がありません', 'error');
          return;
        }
        
        // Show loading state
        showLoadingState(id, true);
        
        // Check if clipboard API is available
        if (!navigator.clipboard) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = text;
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          
          try {
            const result = document.execCommand('copy');
            document.body.removeChild(textArea);
            
            if (result) {
              showMessage('✅ コピーしました', 'success');
              updateButtonState(id, true);
            } else {
              showMessage('コピーに失敗しました。手動でコピーしてください', 'error');
            }
          } catch (err) {
            document.body.removeChild(textArea);
            showMessage('コピー機能がご利用いただけません。手動でコピーしてください', 'error');
          }
          showLoadingState(id, false);
          return;
        }
        
        // Modern clipboard API
        navigator.clipboard.writeText(text)
          .then(() => {
            showMessage('✅ コピーしました', 'success');
            updateButtonState(id, true);
            showLoadingState(id, false);
          })
          .catch((err) => {
            console.error('Clipboard error:', err);
            showLoadingState(id, false);
            
            // Provide specific error messages
            if (err.name === 'NotAllowedError') {
              showMessage('クリップボードへのアクセスが許可されていません。ブラウザの設定を確認してください', 'error');
            } else if (err.name === 'SecurityError') {
              showMessage('セキュリティ上の理由でコピーできません。HTTPSでアクセスしてください', 'error');
            } else {
              showMessage('コピーに失敗しました。手動でテキストを選択してコピーしてください', 'error');
            }
          });
      }
      
      function showLoadingState(id, isLoading) {
        const btns = document.querySelectorAll(`[onclick="copyText('${id}')"]`);
        btns.forEach((btn) => {
          if (isLoading) {
            btn.dataset.originalText = btn.textContent;
            btn.textContent = "⏳ コピー中...";
            btn.disabled = true;
            btn.style.opacity = '0.6';
          } else {
            if (btn.dataset.originalText) {
              btn.textContent = btn.dataset.originalText;
              delete btn.dataset.originalText;
            }
            btn.disabled = false;
            btn.style.opacity = '1';
          }
        });
      }
      
      function updateButtonState(id, success) {
        const btns = document.querySelectorAll(`[onclick="copyText('${id}')"]`);
        btns.forEach((btn) => {
          if (success) {
            const original = btn.dataset.originalText || btn.textContent;
            btn.textContent = "✅ コピー済み";
            btn.style.opacity = '0.7';
            setTimeout(() => {
              btn.textContent = original;
              btn.style.opacity = '1';
            }, 2000);
          }
        });
      }
    </script>
  </body>
</html>
